{% extends "base.html" %}
{% block content %}
<h2>Analytics</h2>

{% if error %}
  <div class="alert alert-warning">{{ error }}</div>
{% endif %}

{% if log_metrics %}
  <h3>Logistic Regression</h3>
  <ul>
    <li>Samples: {{ log_metrics.n_samples }}</li>
    <li>Accuracy (train): {{ (log_metrics.accuracy * 100) | round(1) }}%</li>
    <li>AUC (train): {{ (log_metrics.auc * 100) | round(1) if log_metrics.auc is not none else "n/a" }}</li>
    <li>Threshold for "difficult": {{ (log_metrics.threshold * 100) | round(1) }}%</li>
  </ul>

  <h4>Confusion matrix (using threshold)</h4>
  <ul>
    <li>TN: {{ log_metrics.confusion.tn }}</li>
    <li>FP: {{ log_metrics.confusion.fp }}</li>
    <li>FN: {{ log_metrics.confusion.fn }}</li>
    <li>TP: {{ log_metrics.confusion.tp }}</li>
  </ul>

  <h4>ROC curve</h4>
  <canvas id="rocChart"></canvas>
{% endif %}

{% if nn_metrics %}
  <h3>Neural Network (PyTorch, validation)</h3>
  <ul>
    <li>Train samples: {{ nn_metrics.n_train }}</li>
    <li>Validation samples: {{ nn_metrics.n_val }}</li>
    <li>Accuracy (val): {{ (nn_metrics.accuracy_val * 100) | round(1) }}%</li>
    <li>AUC (val): {{ (nn_metrics.auc_val * 100) | round(1) if nn_metrics.auc_val is not none else "n/a" }}</li>
    <li>Brier score (val): {{ nn_metrics.brier_val | round(3) if nn_metrics.brier_val is not none else "n/a" }}</li>
  </ul>
{% endif %}
{% if nn_error %}
  <div class="alert alert-info">{{ nn_error }}</div>
{% endif %}

{% if log_metrics %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const fpr = {{ log_metrics.fpr | tojson }};
  const tpr = {{ log_metrics.tpr | tojson }};

  const ctx = document.getElementById('rocChart').getContext('2d');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: fpr,
      datasets: [{
        label: 'ROC curve',
        data: tpr,
        fill: false,
      }]
    },
    options: {
      scales: {
        x: { title: { display: true, text: 'False Positive Rate' } },
        y: { title: { display: true, text: 'True Positive Rate' }, min: 0, max: 1 }
      }
    }
  });
</script>
{% endif %}
{% endblock %}
